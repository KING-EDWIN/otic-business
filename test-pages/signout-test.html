<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Out Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .info { background: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 4px; margin: 10px 0; }
        button { background: #040458; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #030344; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>üîß Sign Out Test</h1>
    
    <div class="test-section">
        <h3>Current Auth Status</h3>
        <div id="authStatus" class="info">
            <button onclick="checkAuthStatus()">Check Auth Status</button>
        </div>
    </div>

    <div class="test-section">
        <h3>Sign Out Test</h3>
        <div class="info">
            <p>This will test the sign out functionality step by step:</p>
            <button onclick="testSignOut()" id="signOutBtn">Test Sign Out</button>
            <div id="signOutResult"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>Manual Sign Out</h3>
        <div class="info">
            <p>Try signing out manually and check the console for logs:</p>
            <button onclick="manualSignOut()">Manual Sign Out</button>
            <div id="manualResult"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>Clear All Data</h3>
        <div class="info">
            <p>Nuclear option - clear all auth data:</p>
            <button onclick="clearAllData()" style="background: #dc3545;">Clear All Auth Data</button>
            <div id="clearResult"></div>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://jvgiyscchxxekcbdicco.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2Z2l5c2NjaHh4ZWtjYmRpY2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDc0MTAsImV4cCI6MjA3MjcyMzQxMH0.TPHpZCjKC0Xb-IhrS0mT_2IdS-mqANDjwPsmJCWUAu8';
        
        const supabase = createClient(supabaseUrl, supabaseKey);

        async function checkAuthStatus() {
            const resultDiv = document.getElementById('authStatus');
            resultDiv.innerHTML = '<div class="info">üîÑ Checking auth status...</div>';

            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Auth Error: ${error.message}</div>`;
                } else if (session) {
                    resultDiv.innerHTML = `<div class="success">‚úÖ User is signed in: ${session.user.email}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="info">‚ÑπÔ∏è No user signed in</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testSignOut() {
            const resultDiv = document.getElementById('signOutResult');
            const btn = document.getElementById('signOutBtn');
            
            btn.disabled = true;
            resultDiv.innerHTML = '<div class="info">üîÑ Testing sign out...</div>';

            try {
                console.log('üîÑ Starting sign out test...');
                
                // Step 1: Check current session
                const { data: { session: beforeSession } } = await supabase.auth.getSession();
                console.log('üìã Before sign out - Session:', beforeSession);
                
                // Step 2: Sign out
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    console.error('‚ùå Sign out error:', error);
                    resultDiv.innerHTML = `<div class="error">‚ùå Sign out error: ${error.message}</div>`;
                    return;
                }
                
                console.log('‚úÖ Supabase sign out successful');
                
                // Step 3: Check session after sign out
                const { data: { session: afterSession } } = await supabase.auth.getSession();
                console.log('üìã After sign out - Session:', afterSession);
                
                // Step 4: Clear local storage
                localStorage.removeItem('supabase.auth.token');
                sessionStorage.clear();
                console.log('üßπ Local storage cleared');
                
                resultDiv.innerHTML = `<div class="success">‚úÖ Sign out test successful!<br>
                    Before: ${beforeSession ? 'Signed in' : 'Not signed in'}<br>
                    After: ${afterSession ? 'Still signed in (ERROR!)' : 'Signed out'}</div>`;
                
            } catch (error) {
                console.error('‚ùå Test error:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Test error: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
            }
        }

        async function manualSignOut() {
            const resultDiv = document.getElementById('manualResult');
            resultDiv.innerHTML = '<div class="info">üîÑ Manual sign out...</div>';

            try {
                console.log('üîÑ Manual sign out started');
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    console.error('‚ùå Manual sign out error:', error);
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                } else {
                    console.log('‚úÖ Manual sign out successful');
                    resultDiv.innerHTML = `<div class="success">‚úÖ Manual sign out successful!</div>`;
                    
                    // Clear local storage
                    localStorage.removeItem('supabase.auth.token');
                    sessionStorage.clear();
                    
                    // Redirect to home
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1000);
                }
            } catch (error) {
                console.error('‚ùå Manual sign out error:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function clearAllData() {
            const resultDiv = document.getElementById('clearResult');
            resultDiv.innerHTML = '<div class="info">üîÑ Clearing all data...</div>';

            try {
                // Clear all possible auth-related storage
                localStorage.clear();
                sessionStorage.clear();
                
                // Clear cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                console.log('üßπ All data cleared');
                resultDiv.innerHTML = `<div class="success">‚úÖ All auth data cleared!</div>`;
                
                // Redirect to home
                setTimeout(() => {
                    window.location.href = '/';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Clear data error:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Check auth status on page load
        window.addEventListener('load', checkAuthStatus);
    </script>

    <!-- Load Supabase client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</body>
</html>
